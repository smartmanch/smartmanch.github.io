<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rainbow Simulation - CC BY Rohitash Bharia</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #1a1a1a;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px 10px 0 10px;
            color: #eee;
            min-height: 100vh;
        }
        h2 { color: #f1c40f; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        
        .controls {
            background: rgba(50, 50, 50, 0.8);
            backdrop-filter: blur(5px);
            padding: 10px 25px;
            border-radius: 30px;
            border: 1px solid #444;
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }

        canvas {
            border: 3px solid #333;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        input[type=range] { width: 180px; cursor: pointer; accent-color: #f1c40f; }

        /* --- CC BY Certificate Footer --- */
        .cc-footer {
            margin-top: auto; /* Push to bottom */
            padding: 25px;
            background-color: #2c3e50;
            border-top: 5px solid #f1c40f;
            width: 100%;
            max-width: 800px;
            text-align: center;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 -5px 25px rgba(0,0,0,0.3);
        }
        
        .cc-icons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .cc-icons img {
            height: 35px;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
        }

        .license-text {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }
        
        .attribution {
            font-size: 14px;
            color: #bdc3c7;
        }
        .attribution strong { color: #f1c40f; }
    </style>
</head>
<body>

    <h2>इंद्रधनुष: प्रेक्षक और भौतिकी (Observer View)</h2>

    <div class="controls">
        <label>सूर्य किरण की ऊँचाई (Sun Ray):</label>
        <input type="range" id="sliderY" min="20" max="80" value="45" step="0.5">
    </div>

    <div id="canvas-container"></div>

    <footer class="cc-footer">
        <div class="cc-icons">
            <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" alt="CC">
            <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" alt="BY">
        </div>
        
        <div class="license-text">
            CC BY Rohitash Bharia
        </div>
        
        <div class="attribution">
            Licensed under Creative Commons Attribution 4.0 International.<br>
            Developed for <strong>Smart Manch</strong>
        </div>
    </footer>

    <script>
        let dropRadius = 90; 
        let slider;
        
        const colors = [
            { name: 'Red', hex: '#FF0000', n: 1.20 },
            { name: 'Orange', hex: '#FF7F00', n: 1.23 },
            { name: 'Yellow', hex: '#FFFF00', n: 1.26 },
            { name: 'Green', hex: '#00FF00', n: 1.29 },
            { name: 'Blue', hex: '#0000FF', n: 1.32 },
            { name: 'Indigo', hex: '#4B0082', n: 1.35 },
            { name: 'Violet', hex: '#9400D3', n: 1.38 }
        ];

        function setup() {
            let canvas = createCanvas(800, 500);
            canvas.parent('canvas-container');
            angleMode(DEGREES);
            slider = select('#sliderY');
        }

        function draw() {
            drawScene();

            // Settings
            let dropX = width / 2 + 150; 
            let dropY = height / 2 - 100;
            let humanX = 150;
            let groundLevel = height - 80;

            drawSun(50, 50);

            // Raindrop
            push();
            translate(dropX, dropY);
            drawRaindrop(0, 0, dropRadius);

            // Ray Tracing
            let sliderVal = parseFloat(slider.value());
            let rayY = -sliderVal; 
            let rayStartX = -dropX; 
            let entryX = -sqrt(sq(dropRadius) - sq(rayY));

            // Incident Ray
            stroke(255); strokeWeight(3);
            drawingContext.shadowBlur = 10; drawingContext.shadowColor = 'white';
            line(rayStartX, rayY, entryX, rayY);
            drawingContext.shadowBlur = 0;

            let i = asin(rayY / dropRadius); 
            let normalAngle = atan2(rayY, entryX);

            colors.forEach((col, index) => {
                let r_ang = asin(sin(i) / col.n);

                // Path 1
                let backAngle = normalAngle - (180 - 2 * r_ang);
                let backX = dropRadius * cos(backAngle);
                let backY = dropRadius * sin(backAngle);
                stroke(col.hex); strokeWeight(2);
                line(entryX, rayY, backX, backY);

                // Path 2
                let exitAngle = backAngle - (180 - 2 * r_ang);
                let exitX = dropRadius * cos(exitAngle);
                let exitY = dropRadius * sin(exitAngle);
                line(backX, backY, exitX, exitY);

                // Path 3: Exit to Eye
                let deviation = 180 + 2*i - 4*r_ang;
                let finalDir = 180 - deviation; 
                
                let rayLen = 600;
                let finalX = exitX + rayLen * cos(finalDir);
                let finalY = exitY + rayLen * sin(finalDir);

                stroke(col.hex); strokeWeight(2);
                drawingContext.shadowBlur = 8; drawingContext.shadowColor = col.hex;
                line(exitX, exitY, finalX, finalY);
                drawingContext.shadowBlur = 0;
            });
            pop(); 

            // Realistic Human Observer
            drawRealisticHuman(humanX, groundLevel);
            
            // Labels
            fill(255); noStroke(); textSize(14);
            text("सूर्य का प्रकाश", 20, 100);
            text("वर्षा की बूंद", dropX - 40, dropY - dropRadius - 15);
        }

        function drawScene() {
            let c1 = color(20, 40, 80);
            let c2 = color(100, 180, 255);
            for(let y=0; y<height-80; y++){
                let n = map(y,0,height-80,0,1);
                let newc = lerpColor(c1,c2,n);
                stroke(newc); line(0,y,width,y);
            }
            noStroke(); fill(34, 100, 34);
            rect(0, height - 80, width, 80);
            fill(50, 120, 50); rect(0, height - 80, width, 15);
        }

        function drawSun(x, y) {
            push(); translate(x, y); noStroke();
            fill(255, 220, 100, 80); ellipse(0,0,90,90);
            fill(255, 255, 200); ellipse(0,0,40,40);
            pop();
        }

        function drawRaindrop(x, y, r) {
            noStroke(); fill(200, 230, 255, 60); ellipse(x, y, r*2, r*2);
            stroke(255, 255, 255, 150); strokeWeight(3); noFill(); ellipse(x, y, r*2-2, r*2-2);
            noStroke(); fill(255, 255, 255, 180); ellipse(-r/2, -r/2.5, 30, 20);
        }

        function drawRealisticHuman(x, y) {
            push();
            translate(x, y); 
            noStroke();
            fill(60, 80, 120); rect(-12, -55, 10, 55); rect(2, -55, 10, 55); 
            fill(100, 50, 50); beginShape(); vertex(-20, -55); rect(-20, -105, 40, 50, 5); endShape();
            fill(220, 180, 150); ellipse(0, -115, 30, 35);
            fill(50, 30, 20); arc(0, -120, 32, 30, 180, 360, CHORD);
            fill(255); ellipse(5, -118, 8, 6); fill(0); ellipse(7, -120, 4, 4);
            stroke(100, 50, 50); strokeWeight(10); line(-15, -95, -10, -70); line(15, -95, 25, -80);
            noStroke(); fill(255); textSize(16); textStyle(BOLD); textAlign(CENTER);
            text("प्रेक्षक", 0, 25);
            pop();
        }
    </script>
</body>
</html>